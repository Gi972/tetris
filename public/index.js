+function(){function e(e){return e.toString().split("").reverse().join("").match(/.{1,3}/g).join(" ").split("").reverse().join("")}function n(e,n,t){var r=t-e.length-n.length;return e+l.repeat(r>0?r:0)+n}function t(e){return document.getElementById(e)}function r(e,n){function t(){e.innerHTML="|/-\\".charAt(o)+l.repeat(n),o=++o>3?0:o}var r=e.innerHTML,o=0;n=(n||0)>0?n-1:0;var i=setInterval(t,50);return t(),function(){clearInterval(i),e.innerHTML=r}}function o(e,n,t){function r(e){(e.which||e.keyCode)===t&&n()}return e.addEventListener("keydown",r),function(){e.removeEventListener("keydown",r)}}function i(e,n){return o(e,n,13)}function a(e,n){return o(e,n,27)}function s(o,s,c){function u(){t("userboard-send").removeEventListener("click",l),t("userboard").style.display="none",p(),y()}function l(){var e=t("name-input").value.toLocaleUpperCase();if(e&&!(e.length>10)){t("userboard-send").removeEventListener("click",l),p(),o.name=e;var n=new XMLHttpRequest;n.open("POST","https://tetris-tiurin.rhcloud.com/api/scores",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){n.readyState==XMLHttpRequest.DONE&&200==n.status&&(i(),u(),s())},n.send(Object.keys(o).map(function(e){return e+"="+o[e]}).join("&"));var i=r(t("userboard-send"));try{localStorage.setItem("tetrisName",e)}catch(e){}}}t("userboard").style.display="block",t("your-score").innerHTML=n("YOUR SCORE:",e(o.score),32);try{var d=(new Date).getTime(),f=JSON.parse(localStorage.getItem("tetrisScore"))||[];f.push({t:d,s:o.score}),localStorage.setItem("tetrisScore",JSON.stringify(f));var v=f.sort(function(e,n){return n.s-e.s})[0].s;t("your-best-score").innerHTML=n("YOUR BEST SCORE:",e(v),32)}catch(e){}try{t("name-input").value=localStorage.getItem("tetrisName")}catch(e){}t("name-input").focus(),t("userboard-send").addEventListener("click",l);var p=i(t("name-input"),l),y=a(document,function(){u(),c()})}function c(o){function i(){s.style.display="none",u.removeEventListener("click",i),l(),o()}var s=t("leaderboard");if("block"!==s.style.display){s.style.display="block";var c=r(t("score-leaders"),32),u=t("leaderboard-close");u.addEventListener("click",i),u.focus();var l=a(document,i),d=new XMLHttpRequest;d.open("GET","https://tetris-tiurin.rhcloud.com/api/scores",!0),d.onload=function(r){var o=JSON.parse(r.target.response);"ok"===o.status&&(c(),t("score-leaders").innerHTML=o.scores.map(function(t){return n(t.name,e(t.score),32)}).join("<br>"))},d.send()}}function u(){function e(){clearInterval(t),t=0}function n(n){if(!(n.altKey||n.ctrlKey||n.metaKey||n.shiftKey||(keyCode=n.which>0?n.which:n.keyCode,t&&keyCode===r))){r=keyCode;var o=function(){TETRIS.pressKey(keyCode)};o(),e();var i={37:100,39:100,40:50};t=setInterval(o,i[keyCode]||200)}}var t,r;return TETRIS.upause(),setTimeout(function(){addEventListener("keyup",e),addEventListener("keydown",n)}),function(){clearInterval(t),removeEventListener("keyup",e),removeEventListener("keydown",n),TETRIS.pause()}}var l="&nbsp;",d=u();TETRIS.on({finish:function(e,n,t){d(),s({score:e,level:n,rowsHit:t},function(){c(function(){TETRIS.start(),d=u()})},function(){TETRIS.start(),d=u()})},nextFrame:function(e){e=e.replace(/[ <>]|\n\r/g,function(e){return{" ":"&nbsp;","<":"&lsaquo;",">":"&rsaquo;","\n\r":"<br>"}[e]}),t("container").innerHTML=e}}),t("leaderboard-link").addEventListener("click",function(){d(),c(function(){d=u()})})}();