+function(){function e(e){return e.toString().split("").reverse().join("").match(/.{1,3}/g).join(" ").split("").reverse().join("")}function n(e,n,t){var r=t-e.length-n.length;return e+f.repeat(r>0?r:0)+n}function t(e){return document.getElementById(e)}function r(e,n){function t(){e.innerHTML="|/-\\".charAt(o)+f.repeat(n),o=++o>3?0:o}var r=e.innerHTML,o=0;n=(n||0)>0?n-1:0;var i=setInterval(t,50);return t(),function(){clearInterval(i),e.innerHTML=r}}function o(e,n,t){function r(e){(e.which||e.keyCode)===t&&n()}return e.addEventListener("keydown",r),function(){e.removeEventListener("keydown",r)}}function i(e,n){return o(e,n,13)}function s(e,n){return o(e,n,27)}function c(o,c,a){function u(){t("userboard-send").removeEventListener("click",d),t("userboard").style.display="none",p(),m()}function d(){var e=t("name-input").value.toLocaleUpperCase();if(e&&!(e.length>10)){t("userboard-send").removeEventListener("click",d),p(),o.name=e;var n=new XMLHttpRequest;n.open("POST","https://tetris-tiurin.rhcloud.com/api/scores",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){n.readyState==XMLHttpRequest.DONE&&200==n.status&&(i(),u(),c())},n.send(Object.keys(o).map(function(e){return e+"="+o[e]}).join("&"));var i=r(t("userboard-send"));try{localStorage.setItem("tetrisName",e)}catch(e){}}}t("userboard").style.display="block",t("your-score").innerHTML=n("YOUR SCORE:",e(o.score),32);try{var l=(new Date).getTime(),f=JSON.parse(localStorage.getItem("tetrisScore"))||[];f.push({t:l,s:o.score}),localStorage.setItem("tetrisScore",JSON.stringify(f));var v=f.sort(function(e,n){return n.s-e.s})[0].s;t("your-best-score").innerHTML=n("YOUR BEST SCORE:",e(v),32)}catch(e){}try{t("name-input").value=localStorage.getItem("tetrisName")}catch(e){}t("name-input").focus(),t("userboard-send").addEventListener("click",d);var p=i(t("name-input"),d),m=s(document,function(){u(),a()})}function a(o){function i(){c.style.display="none",u.removeEventListener("click",i),d(),o()}var c=t("leaderboard");if("block"!==c.style.display){c.style.display="block";var a=r(t("score-leaders"),32),u=t("leaderboard-close");u.addEventListener("click",i),u.focus();var d=s(document,i),l=new XMLHttpRequest;l.open("GET","https://tetris-tiurin.rhcloud.com/api/scores",!0),l.onload=function(r){var o=JSON.parse(r.target.response);"ok"===o.status&&(a(),t("score-leaders").innerHTML=o.scores.map(function(e){return e.time=new Date(e.time).getTime(),e}).sort(function(e,n){return n.score!=e.score?n.score-e.score:e.time-n.time}).map(function(t){return n(t.name,e(t.score),32)}).join("<br>"))},l.send()}}function u(){function e(){clearInterval(d),d=0}function n(n){if(keyCode=n.which>0?n.which:n.keyCode,!d||keyCode!==l){l=keyCode;var t=function(){TETRIS.pressKey(keyCode)};t(),e();var r={37:100,39:100,40:50};d=setInterval(t,r[keyCode]||200)}}return TETRIS.upause(),setTimeout(function(){addEventListener("keyup",e),addEventListener("keydown",n)}),function(){removeEventListener("keyup",e),removeEventListener("keydown",n),TETRIS.pause()}}var d,l,f="&nbsp;",v=u();TETRIS.on({finish:function(e,n,t){v(),c({score:e,level:n,rowsHit:t},function(){a(function(){TETRIS.start(),v=u()})},function(){TETRIS.start(),v=u()})},nextFrame:function(e){e=e.replace(/[ <>]|\n\r/g,function(e){return{" ":"&nbsp;","<":"&lsaquo;",">":"&rsaquo;","\n\r":"<br>"}[e]}),t("container").innerHTML=e}}),t("leaderboard-link").addEventListener("click",function(){v(),a(function(){v=u()})})}();